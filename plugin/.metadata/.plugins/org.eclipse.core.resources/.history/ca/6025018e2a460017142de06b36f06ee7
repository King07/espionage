package edu.cwi.espionage.util;

import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;

import edu.cwi.espionage.model.ProcessCase;

public class IdleTimeTable {
	private Map<String, HashMap<Integer, Long>> idleTimeTable;

	public IdleTimeTable() {
		idleTimeTable = new HashMap<String, HashMap<Integer, Long>>();
	}

	public boolean contains(String date) {
		return idleTimeTable.containsKey(date);
	}
	
	public boolean containHour(String date, Integer hour) {
		return idleTimeTable.get(date).containsKey(hour);
	}

	public void add(String date, Integer hour, Long idleTime) {
		HashMap<Integer,Long> hLookup = new HashMap<Integer,Long>();
		if(contains(date)){
			if(containHour(date, hour)){
				Long lookup = DateManipulator.add(lookupIdleTime(date,hour), idleTime);
				hLookup.put(hour, lookup);
				idleTimeTable.put(date, hLookup);
			}
			
		}else{
			hLookup.put(hour, idleTime);
			idleTimeTable.put(date, hLookup);
		}
	}

	public Long lookupIdleTime(String date, Integer hour) {
		if(idleTimeTable.get(date) != null){
			if(idleTimeTable.get(date).get(hour) != null){
				return idleTimeTable.get(date).get(hour);
			}
		}
		return new Long(0);
	}
//
//	public Boolean isEmpty() {
//		return idleTimeTable.isEmpty();
//	}
	
	public Long total() {
		Long total = new Long(0);
		Iterator<Entry<String, HashMap<Integer, Long>>> pit = idleTimeTable.entrySet().iterator();
	    while (pit.hasNext()) {
	    	Map.Entry<String, HashMap<Integer, Long>> pair = pit.next();
	    	HashMap<Integer, Long> hourValues = pair.getValue();
	    	total += hourValues.values().stream().mapToLong(Long::longValue).sum();
	    }
		return total;
	}

	@Override
	public String toString() {
		return idleTimeTable.toString();
	}

}

